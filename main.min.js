let Elem={noSpecChars:function(text,lowercase=!1){function replaceAll(string,search,replace){return string.split(search).join(replace)}"string"!=typeof text&&(text=text.toString());let specialChars={"é":"e","á":"a","ó":"o","ö":"o","ő":"o","ú":"u","ü":"u","ű":"u","í":"i","É":"E","Á":"A","Ó":"O","Ö":"O","Ő":"O","Ú":"U","Ü":"U","Ű":"U","Í":"I"," ":"-","/":"-",":":"-",";":"-","=":"-"};for(let char in specialChars)text=replaceAll(text,char,specialChars[char]);return lowercase?text.toLowerCase():text},Create:function(parameters){let tag=parameters.tag||"div",attributes=parameters.attributes||{},dataset=parameters.dataset||{},children=parameters.children||[],eventStarter=parameters.eventStarter||null,eventFunction=parameters.eventFunction||null,content=parameters.content||null,text=parameters.text||null,targetParent="string"==typeof parameters.targetParent?document.querySelector(parameters.targetParent)||document.getElementById(parameters.targetParent):"object"==typeof parameters.targetParent?parameters.targetParent:null,elem=document.createElement(tag);for(let attr in attributes)elem.setAttribute(attr,"class"==attr||"id"==attr?this.noSpecChars(attributes[attr]):attributes[attr]);for(let i in children){let child=children[i];"object"!=typeof child&&(child=document.createTextNode(child)),elem.appendChild(child)}content&&(elem.innerHTML=content),text&&(elem.text=text),eventStarter&&eventFunction&&elem.addEventListener(eventStarter,eventFunction),targetParent&&targetParent.appendChild(elem);for(let data in dataset)elem.dataset[data]=dataset[data];return elem}};function uniqueID(){return Math.random().toString(36).substr(2,9)}let inputAndLabel={Create:function(parameters){let tag=parameters.tag||"input",type=parameters.type||null,id=parameters.id||tag+"-"+uniqueID(),label=parameters.label||tag+"-id",labelLast=parameters.labelLast||!1,options=parameters.options||null,checked=parameters.checked||!1,wrapperName=parameters.wrapperName||type,wrapper=parameters.wrapper||!0,eventStarter=parameters.eventStarter,eventFunction=parameters.eventFunction,children=[Elem.Create({tag:"label",content:label,attributes:{class:wrapperName+"-label",for:id}}),Elem.Create({tag:tag,attributes:{type:type,class:wrapperName+"-input",id:id,checked:checked},children:options,eventStarter:wrapper?eventStarter:null,eventFunction:wrapper?eventFunction:null})],complex;return labelLast&&children.reverse(),Elem.Create({tag:"div",attributes:{class:wrapperName+"-wrapper"},children:children})}};class dataTable{constructor(parameters){this.dataFile=parameters.dataFile,this.container=document.querySelector("."+parameters.containerID),this.tableController=null,this.table=document.createElement("table"),this.settings={columnShow:{},dateFilterColumns:parameters.dateFilterColumns,dateFilters:{beginDate:null,endDate:null,firstRecordDate:null,LastRecordDate:null},textFilters:{},columnsToSummarize:parameters.columnsToSummarize,rowNumberOptions:[10,25,50,100,200,500,1e3],page:0,showRowNumber:10,currencyNames:["Ft","EUR","USD","HUF","CHF"],specialChars:{"é":"e","á":"a","ó":"o","ö":"o","ő":"o","ú":"u","ü":"u","ű":"u","í":"i"," ":"_","É":"E","Á":"A","Ó":"O","Ö":"O","Ő":"O","Ú":"U","Ü":"U","Ű":"U","Í":"I"}},this.tableData={header:{},body:[{}],footer:{},rowNumber:null,recordNumber:0}}init(){let that=this;this.sendRequest((function(CSVdata){that.buildTableObject(CSVdata)}),this.dataFile,"GET",!1),this.renderTable(),this.renderController()}sendRequest(callback,url,method="GET",async=!0,body=null,header="text/plain"){let xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&callback(xhr.responseText)},xhr.open(method,url,async),xhr.setRequestHeader("Content-Type",header),xhr.send(body)}renderController(){this.tableController=Elem.Create({tag:"div",attributes:{class:"tableController"},targetParent:this.container}),this.container.insertBefore(this.tableController,this.table),this.renderPageControl(),this.dateFilter(),this.renderColumnControl()}renderColumnFilter(){let that=this,filters={};for(let column in this.tableData.header){let texts=[];for(let row of this.tableData.body){let colValueKey=null;"string"===row[column].type&&(colValueKey="cell"),!texts.includes(row[column][colValueKey])&&colValueKey&&texts.push(row[column].cell)}if(texts.length>0){filters[column]=texts;let headerCell=document.getElementById(column);function generateOptionText(){texts.sort(),texts.unshift("Nincs szűrés");let options=[];for(let text of texts){let option=Elem.Create({tag:"option",content:text});options.push(option)}return options}Elem.Create({tag:"select",attributes:{id:`${column}-textFilter`},targetParent:headerCell,children:generateOptionText(),eventStarter:"change",eventFunction:function(e){e.preventDefault(),that.settings.textFilters[column]=this.value,that.setMaxPage(),that.renderTable()}})}}}dateFilter(){let that=this;function generateFilterText(){function dateToText(date){let dateTxt=String(date);return dateTxt.slice(0,4)+". "+dateTxt.slice(4,6)+". "+dateTxt.slice(6,8)+"."}let filterText;return"Dátumszűrés: "+dateToText(that.settings.dateFilters.beginDate)+" - "+dateToText(that.settings.dateFilters.endDate)}this.settings.dateFilters.filterText=Elem.Create({tag:"p",attributes:{class:"filterText",id:"filterText"},content:generateFilterText()}),Elem.Create({tag:"div",attributes:{class:"dateFilterContainer",id:"dateFilterContainer"},targetParent:this.tableController,children:[inputAndLabel.Create({tag:"input",type:"date",id:"beginDate",label:"Kezdő dátum: ",eventStarter:"change",eventFunction:function(e){e.preventDefault();let newBegintDate=Number(this.value.split("-").join(""));that.settings.dateFilters.beginDate=newBegintDate<that.settings.dateFilters.firstRecordDate?that.settings.dateFilters.firstRecordDate:newBegintDate,that.settings.dateFilters.filterText.innerHTML=generateFilterText(),that.renderTable()}}),inputAndLabel.Create({tag:"input",type:"date",id:"endDate",label:"Befejező dátum: ",eventStarter:"change",eventFunction:function(e){e.preventDefault();let newEndDate=Number(this.value.split("-").join(""));that.settings.dateFilters.endDate=newEndDate>that.settings.dateFilters.LastRecordDate?that.settings.dateFilters.LastRecordDate:newEndDate,that.settings.dateFilters.filterText.innerHTML=generateFilterText(),that.renderTable()}}),that.settings.dateFilters.filterText]})}renderColumnControl(){let that=this,columnCheckBoxes=[];for(let column in this.tableData.header)columnCheckBoxes.push(inputAndLabel.Create({tag:"input",type:"checkbox",id:`${column}-checkbox`,checked:that.settings.columnShow[column],label:this.tableData.header[column].name,wrapperName:"columnFilter",labelLast:!0,eventStarter:"click",eventFunction:function(){let selecetdColumn=that.table.querySelectorAll("."+this.id.split("-")[0]);that.settings.columnShow[this.id]=this.checked,selecetdColumn.forEach(cell=>{this.checked?cell.classList.remove("hide"):cell.classList.add("hide")})}}));Elem.Create({tag:"div",attributes:{class:"checkBoxesContainer",id:"checkBoxesContainer"},targetParent:this.tableController,children:columnCheckBoxes})}renderPageControl(){let that=this;function generateOptionText(){that.settings.rowNumberOptions.push(that.tableData.allRecordNumber);let options=[];for(let rowNumberOption of that.settings.rowNumberOptions)if(rowNumberOption<=that.tableData.allRecordNumber){let text;text=rowNumberOption!==that.tableData.allRecordNumber?rowNumberOption:"összes",text+=" sor";let option=Elem.Create({tag:"option",content:text,attributes:{value:rowNumberOption}});options.push(option)}return options}function generatePageText(){let text;return`${that.settings.page+1}. oldal a(z) ${that.settings.maxPage+1} oldalból`}this.settings.pageNumberText=Elem.Create({tag:"p",attributes:{id:"siteNumber"},content:generatePageText()}),Elem.Create({tag:"div",attributes:{class:"selectContainer"},targetParent:this.tableController,children:[inputAndLabel.Create({tag:"select",label:"Sorok száma: ",id:"rowNumberSelect",options:generateOptionText(),eventStarter:"change",eventFunction:function(e){e.preventDefault();let currentRow=that.settings.showRowNumber*that.settings.page;that.settings.showRowNumber=Number(this.value),that.settings.page=Math.floor(currentRow/that.settings.showRowNumber),that.setMaxPage(),that.settings.pageNumberText.innerHTML=generatePageText(),that.renderTable()}}),Elem.Create({tag:"button",attributes:{id:"prevPage"},content:"Előző",eventStarter:"click",eventFunction:function(e){e.preventDefault(),that.settings.page--,that.settings.page<0&&(that.settings.page=0),that.settings.pageNumberText.innerHTML=generatePageText(),that.renderTable()}}),Elem.Create({tag:"button",attributes:{id:"nextPage"},content:"Következő",eventStarter:"click",eventFunction:function(e){e.preventDefault(),that.settings.page++,that.settings.page>that.settings.maxPage&&(that.settings.page=that.settings.maxPage),that.settings.pageNumberText.innerHTML=generatePageText(),that.renderTable()}}),that.settings.pageNumberText]})}buildTableObject(rawData){let that=this,allLines=rawData.split(/\r\n|\n/),dataRows=[],columnNames=[],recordDates=[];this.tableData.rowNumber=allLines.length;for(let[i,line]of allLines.entries()){let record={},row=line.split(";"),rowNr=i,emptyCell=0;for(let[colNr,col]of row.entries())if(0===rowNr){let columnName=noSpecChars(col);columnNames.push(columnName),that.settings.textFilters[columnName]=null,that.tableData.header[columnName]={order:colNr,name:col},that.tableData.footer[columnName]={order:colNr,name:col,summary:!1}}else{0==col.split("").length&&emptyCell++;let cellData=checkCellValue(col);record[columnNames[colNr]]={order:colNr,row:rowNr-1,cell:cellData.col,value:cellData.cellValue,type:cellData.type},"date"===cellData.type&&recordDates.push(Number(record.datum.value)),colNr===row.length-1&&emptyCell<row.length&&dataRows.push(record);for(let columnsToSummarize of that.settings.columnsToSummarize)columnsToSummarize===columnNames[colNr]&&(that.tableData.footer[columnsToSummarize].summary+=record[columnNames[colNr]].value);this.tableData.allRecordNumber=dataRows.length}}function checkCellValue(col){let value;return value=checkDate(col),value||(value=checkTime(col),value||(value=checkNumber(col),value||(value=checkCurrency(col),value||{type:"string",col:col,cellValue:null})))}function checkTime(col){let cellValue;return col.includes(":")?(cellValue=replaceAll(col," ",""),{type:"timeStamp",col:col=`\n            <span\n              class="timeStamp"\n              data-value="${cellValue}"\n              data-type="timeStamp"\n            >${cellValue}</span>`,cellValue:cellValue}):null}function checkDate(col){let cellValue,dateLenghtsCheck=[4,2,2];if(col.includes(".")){cellValue=replaceAll(col," ","");let checkCellValues=cellValue.split(".");if(3===checkCellValues.length){let checker=0;for(let[i,value]of checkCellValues.entries())value.length===dateLenghtsCheck[i]&&checker++;if(checker=3){let date=checkCellValues.join(""),dateUTC=new Date(date);return{type:"date",col:col=`<span\n            class="recordDate"\n            data-year="${checkCellValues[0]}"\n            data-month="${checkCellValues[1]}"\n            data-day="${checkCellValues[2]}"\n            data-type="recordDate"\n            data-dateUTC="${dateUTC}"\n            >${col}</span>`,cellValue:date}}}}return null}function checkNumber(col){let cellValue;return!col.includes(",")&&!col.includes(".")||(cellValue=replaceAll(col," ",""),cellValue=Number(col.replace(",",".")),"number"!=typeof cellValue||isNaN(cellValue))?null:{type:"number",col:col=`\n            <span\n              class="value${"number"!==isNaN(cellValue)?"-error":""}"\n              data-value="${cellValue}"\n              data-type="${typeof cellValue}"\n            >${cellValue}</span>`,cellValue:cellValue}}function checkCurrency(col){for(let currencyName of that.settings.currencyNames){let cellValue;if(col.includes(currencyName))return col=replaceAll(col=col.replace(currencyName,"")," ",""),cellValue=Number(col),col=`\n            <span\n              class="value${"number"!=typeof cellValue?"-error":""}"\n              data-currency="${currencyName}"\n              data-value="${cellValue}"\n              data-type="${typeof cellValue}"\n            >${cellValue}</span>\n            <span class="currency">${currencyName}</span>`,"number"!=typeof cellValue&&(cellValue=0),{type:"currency",col:col,cellValue:cellValue}}return null}function replaceAll(string,search,replace){return string.split(search).join(replace)}function noSpecChars(text,lowercase=!0){for(let char in that.settings.specialChars)text=replaceAll(text,char,that.settings.specialChars[char]);return lowercase?text.toLowerCase():text}this.settings.dateFilters.beginDate=Math.min(...recordDates),this.settings.dateFilters.firstRecordDate=Math.min(...recordDates),this.settings.dateFilters.endDate=Math.max(...recordDates),this.settings.dateFilters.LastRecordDate=Math.max(...recordDates),that.tableData.body=dataRows}renderTableHeader(){let headerCells=[],footerCells=[];for(let headerCell in this.tableData.header){let cell,order=this.tableData.header[headerCell].order;void 0===this.settings.columnShow[headerCell]&&(this.settings.columnShow[headerCell]=!0);let classes=this.settings.columnShow[headerCell]?headerCell:headerCell+" hide";headerCells[order]=Elem.Create({tag:"th",attributes:{id:headerCell,class:classes},content:this.tableData.header[headerCell].name});let footerContent=`${this.tableData.header[headerCell].name}${this.tableData.footer[headerCell].summary?` összesen: ${this.tableData.footer[headerCell].summary}`:""}`;footerCells[order]=Elem.Create({tag:"th",attributes:{class:classes},content:footerContent})}let header=Elem.Create({tag:"thead",children:[Elem.Create({tag:"tr",children:headerCells})]}),footer=Elem.Create({tag:"tfoot",children:[Elem.Create({tag:"tr",children:footerCells})]});return{footer:header.outerHTML,header:footer.outerHTML}}setMaxPage(){this.settings.showRowNumber>=this.tableData.recordNumber?(this.settings.maxPage=0,this.settings.page=0):this.settings.maxPage=Math.floor(this.tableData.recordNumber/this.settings.showRowNumber),this.settings.page=Math.min(this.settings.maxPage,this.settings.page)}getFilteredTableProperties(tableRows){this.tableData.recordNumber=tableRows.length,this.setMaxPage()}filtering(){let that=this;function dateFilterTable(tableRows){for(let filterColumn of that.settings.dateFilterColumns)for(let record of that.tableData.body)that.settings.dateFilters.beginDate<=Number(record[filterColumn].value)&&Number(record.datum.value)<=that.settings.dateFilters.endDate||tableRows.pop(record);return tableRows}function textfilterTable(tableRows){for(let textFilter in that.settings.textFilters)if(null!==that.settings.textFilters[textFilter])for(let[index,record]of tableRows.entries())that.settings.textFilters[textFilter]===record[textFilter].cell&&(console.log(that.settings.textFilters[textFilter],"vs",record[textFilter].cell,index),tableRows.splice(index,1),console.log(tableRows.length));return tableRows}function filterPageTable(tableRows){return tableRows=tableRows.slice(that.settings.page*that.settings.showRowNumber,(that.settings.page+1)*that.settings.showRowNumber)}let filteredTable=this.tableData.body;return console.log(filteredTable.length),filteredTable=dateFilterTable(filteredTable),console.log(filteredTable.length),filteredTable=textfilterTable(filteredTable),console.log(filteredTable.length),this.getFilteredTableProperties(filteredTable),filteredTable=filterPageTable(filteredTable),filteredTable}renderTableBody(filteredTable){let row=[],body;for(let[rowNr,record]of filteredTable.entries()){let rowId,cells=[];for(let column in record){let order=record[column].order;rowId=record[column].row;let classes=!0===this.settings.columnShow[column]?column:column+" hide";cells[order]=Elem.Create({tag:"td",content:record[column].cell,attributes:{class:classes},dataset:{value:null!==record[column].value?record[column].value:"",type:record[column].type}})}row[rowNr]=Elem.Create({tag:"tr",attributes:{id:rowId,class:record.datum.value},children:cells})}return Elem.Create({tag:"tbody",children:row}).outerHTML}renderTable(){let table="",headerAndFooter=this.renderTableHeader();table+=headerAndFooter.header,table+=this.renderTableBody(this.filtering()),table+=headerAndFooter.footer,this.container.appendChild(this.table),this.table.innerHTML=table,this.renderColumnFilter()}}let booking=new dataTable({containerID:"table-container",dataFile:"booking.csv",dateFilterColumns:["datum"],columnsToSummarize:["munkaertek","mennyiseg"]});booking.init();
//# sourceMappingURL=main.min.js.map